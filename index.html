<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SF AOC Meteoå®¢è§‚é¢„æŠ¥</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --bg-body: #0f172a;
            --bg-panel: #1e293b;
            --border: #334155;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --accent: #10b981; /* ECMWF Green */
            --danger: #ef4444; /* TS/FZRA Red */
            --warn: #f59e0b;   /* Warning Orange */
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .navbar {
            flex: 0 0 auto;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 10px 20px;
            display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 50;
        }

        .brand { 
            font-size: 18px; font-weight: 700; letter-spacing: 0.5px; 
            display: flex; align-items: center; gap: 8px; white-space: nowrap;
        }
        .brand-tag { 
            background: var(--accent);
            font-size: 11px; padding: 2px 6px; 
            border-radius: 4px; color: #064e3b; font-weight: bold;
        }
        .disclaimer {
            font-size: 12px; color: #94a3b8; font-weight: normal; margin-left: 5px;
        }
        @media (max-width: 600px) {
            .disclaimer { display: none; }
        }

        /* æœç´¢æ¡†ä¸æ§åˆ¶åŒº */
        .controls {
            display: flex; gap: 10px; align-items: center;
        }
        .search-container {
            display: flex; gap: 0;
            width: 100%; max-width: 200px; /* ç¨å¾®ç¼©å°ä¸€ç‚¹ç»™é”å®šæŒ‰é’®è…¾åœ° */
        }
        input {
            flex: 1;
            background: #020617; border: 1px solid #475569; border-right: none;
            color: #fff; padding: 8px 12px;
            border-radius: 4px 0 0 4px;
            font-family: 'Consolas', monospace; font-weight: bold; text-transform: uppercase;
            outline: none; transition: 0.2s; min-width: 0;
        }
        input:focus { border-color: var(--accent); }
        button {
            background: var(--accent); border: none; padding: 0 15px;
            border-radius: 0 4px 4px 0; color: #064e3b; font-weight: 700; cursor: pointer; white-space: nowrap;
        }
        button:hover { filter: brightness(1.1); }

        /* é”å®šæŒ‰é’®æ ·å¼ */
        .lock-btn {
            background: transparent; border: 1px solid #475569; 
            color: #94a3b8; padding: 7px 12px; border-radius: 4px;
            cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px;
            transition: all 0.2s;
        }
        .lock-btn.active {
            background: rgba(16, 185, 129, 0.2); 
            border-color: var(--accent);
            color: var(--accent);
        }
        .lock-btn:hover { border-color: var(--accent); }

        /* å›¾è¡¨å®¹å™¨ */
        .main-view {
            flex: 1; padding: 10px; position: relative;
            display: flex; flex-direction: column;
        }
        #chart {
            flex: 1; width: 100%; border-radius: 8px; 
            background: var(--bg-panel); border: 1px solid var(--border);
        }

        /* åŠ è½½é®ç½© */
        #loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15,23,42,0.95); z-index: 100;
            display: none; justify-content: center; align-items: center; flex-direction: column;
            text-align: center; padding: 20px;
        }
        .spinner {
            width: 40px; height: 40px; border: 3px solid #334155; border-top-color: var(--accent);
            border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .error-box {
            color: #ef4444; border: 1px solid #ef4444; background: rgba(239, 68, 68, 0.1);
            padding: 15px; border-radius: 6px; margin-top: 10px; font-family: monospace;
            max-width: 80%; display: none;
        }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="brand">
            SF AOC Meteo 
            <span class="brand-tag">ECMWF</span>
            <span class="disclaimer">æœ¬é¢„æµ‹ç»“æœä¸ºæ•°å€¼é¢„æŠ¥å®¢è§‚ç»“è®ºï¼Œè¯·å‹¿ç›´æ¥åº”ç”¨äºèˆªç­è¿è¡Œ</span>
        </div>
        <div class="controls">
            <div class="search-container">
                <input type="text" id="icao" value="ZHEC" placeholder="ZHEC" autocomplete="off" onkeydown="if(event.key==='Enter') query()">
                <button onclick="query()">æŸ¥è¯¢</button>
            </div>
            <button class="lock-btn" id="lockBtn" onclick="toggleLock()">
                <span>ğŸ”“</span> <span>æœªé”å®š</span>
            </button>
        </div>
    </div>
    
    <div class="main-view">
        <div id="chart"></div>
        <div id="loader">
            <div class="spinner" id="spin-icon"></div>
            <div style="color: #10b981; font-weight: bold;" id="load-text">å¤„ç†ä¸­...</div>
            <div class="error-box" id="error-msg"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. WMO 4677 ä»£ç è¡¨
        // ==========================================
        const WMO_CODE_MAP = {
            0: { cn: "æ™´ (SKC/CAVOK)", safe: true },
            1: { cn: "å¤§éƒ¨æ™´ (FEW)", safe: true },
            2: { cn: "éƒ¨åˆ†å¤šäº‘ (SCT)", safe: true },
            3: { cn: "é˜´ (BKN/OVC)", safe: true },
            45: { cn: "é›¾ (FG)", safe: false },
            48: { cn: "å‡‡é›¾ (FZFG)", safe: false, danger: true }, 
            51: { cn: "è½»å¾®æ¯›æ¯›é›¨ (-DZ)", safe: false },
            53: { cn: "æ¯›æ¯›é›¨ (DZ)", safe: false },
            55: { cn: "å¯†æ¯›æ¯›é›¨ (+DZ)", safe: false },
            56: { cn: "è½»å¾®å†»æ¯›æ¯›é›¨ (-FZDZ)", safe: false, danger: true },
            57: { cn: "å¯†å†»æ¯›æ¯›é›¨ (+FZDZ)", safe: false, danger: true },
            61: { cn: "å°é›¨ (-RA)", safe: false },
            63: { cn: "ä¸­é›¨ (RA)", safe: false },
            65: { cn: "å¤§é›¨ (+RA)", safe: false },
            66: { cn: "è½»å¾®å†»é›¨ (-FZRA)", safe: false, danger: true },
            67: { cn: "å¼ºå†»é›¨ (+FZRA)", safe: false, danger: true },
            71: { cn: "å°é›ª (-SN)", safe: false },
            73: { cn: "ä¸­é›ª (SN)", safe: false },
            75: { cn: "å¤§é›ª (+SN)", safe: false },
            77: { cn: "é›ªç²’ (SG/PL)", safe: false }, 
            80: { cn: "å°é˜µé›¨ (-SHRA)", safe: false },
            81: { cn: "ä¸­é˜µé›¨ (SHRA)", safe: false },
            82: { cn: "å¼ºé˜µé›¨ (+SHRA)", safe: false },
            85: { cn: "å°é˜µé›ª (-SHSN)", safe: false },
            86: { cn: "å¤§é˜µé›ª (+SHSN)", safe: false },
            95: { cn: "é›·æš´ (TS)", safe: false, danger: true },
            96: { cn: "é›·æš´ä¼´å°å†°é›¹ (TSGR)", safe: false, danger: true },
            99: { cn: "é›·æš´ä¼´å¤§å†°é›¹ (TSGR)", safe: false, danger: true }
        };

        let EXTERNAL_DB = null;
        let myChart = null;
        let currentZoomInterval = 2; 
        
        // é”å®šåŠŸèƒ½å˜é‡
        let isZoomLocked = false;
        let savedZoomStart = 0;
        let savedZoomEnd = 100;

        function toggleLock() {
            isZoomLocked = !isZoomLocked;
            const btn = document.getElementById('lockBtn');
            
            if (isZoomLocked) {
                btn.classList.add('active');
                btn.innerHTML = '<span>ğŸ”’</span> <span>å·²é”å®š</span>';
                // ç«‹å³ä¿å­˜å½“å‰ZoomçŠ¶æ€
                if(myChart) {
                    const opt = myChart.getOption();
                    if(opt.dataZoom && opt.dataZoom[0]) {
                        savedZoomStart = opt.dataZoom[0].start;
                        savedZoomEnd = opt.dataZoom[0].end;
                    }
                }
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<span>ğŸ”“</span> <span>æœªé”å®š</span>';
                // è§£é”æ—¶ä¸è‡ªåŠ¨é‡ç½®ï¼Œç›´åˆ°ä¸‹æ¬¡æŸ¥è¯¢æˆ–æ‰‹åŠ¨æ‹–åŠ¨
            }
        }

        function setLoader(show, text, error) {
            const el = document.getElementById('loader');
            const txt = document.getElementById('load-text');
            const errBox = document.getElementById('error-msg');
            const spinner = document.getElementById('spin-icon');
            
            el.style.display = show ? 'flex' : 'none';
            
            if (error) {
                spinner.style.display = 'none';
                txt.innerText = "Error";
                txt.style.color = '#ef4444';
                errBox.style.display = 'block';
                errBox.innerText = error;
            } else {
                spinner.style.display = 'block';
                txt.innerText = text || "Loading...";
                txt.style.color = '#10b981';
                errBox.style.display = 'none';
            }
        }

        function getWindDirText(deg) {
            deg = deg % 360;
            if (deg < 0) deg += 360;
            
            if (deg >= 337.5 || deg < 22.5) return "åŒ—";
            if (deg >= 22.5 && deg < 67.5) return "ä¸œåŒ—";
            if (deg >= 67.5 && deg < 112.5) return "ä¸œ";
            if (deg >= 112.5 && deg < 157.5) return "ä¸œå—";
            if (deg >= 157.5 && deg < 202.5) return "å—";
            if (deg >= 202.5 && deg < 247.5) return "è¥¿å—";
            if (deg >= 247.5 && deg < 292.5) return "è¥¿";
            if (deg >= 292.5 && deg < 337.5) return "è¥¿åŒ—";
            return "";
        }

        async function findAirport(icao) {
            const AIRPORTS = {
                'ZHEC': {lat: 30.32, lon: 115.05, name: "é„‚å·èŠ±æ¹–"}
            };

            if (AIRPORTS[icao]) return AIRPORTS[icao];

            if (!EXTERNAL_DB) {
                setLoader(true, "åŠ è½½å…¨çƒåº“...");
                try {
                    const res = await fetch('https://cdn.jsdelivr.net/gh/mwgg/Airports@master/airports.json');
                    if (!res.ok) throw new Error("åŠ è½½å¤±è´¥");
                    EXTERNAL_DB = await res.json();
                } catch (e) {
                    console.warn("å¤–éƒ¨åº“åŠ è½½å¤±è´¥");
                }
            }
            if (EXTERNAL_DB && EXTERNAL_DB[icao]) {
                const d = EXTERNAL_DB[icao];
                return { lat: d.lat, lon: d.lon, name: d.name };
            }
            throw new Error(`æœªæ‰¾åˆ°ä»£ç  [${icao}]`);
        }

        async function query() {
            const code = document.getElementById('icao').value.trim().toUpperCase();
            if (!code || code.length !== 4) return alert("è¯·è¾“å…¥4ä½ä»£ç ");

            // æŸ¥è¯¢å‰å¦‚æœå·²é”å®šï¼Œå…ˆä¿å­˜å½“å‰è¯•å›¾çŠ¶æ€ï¼ˆä»¥é˜²ç”¨æˆ·åœ¨é”å®šçŠ¶æ€ä¸‹æ‹–åŠ¨äº†æ»‘å—ä½†æ²¡ç‚¹æŒ‰é’®ï¼‰
            if (isZoomLocked && myChart) {
                const opt = myChart.getOption();
                if(opt.dataZoom && opt.dataZoom[0]) {
                    savedZoomStart = opt.dataZoom[0].start;
                    savedZoomEnd = opt.dataZoom[0].end;
                }
            }

            setLoader(true, "å®šä½ä¸­...", null);

            try {
                const loc = await findAirport(code);
                setLoader(true, "è·å–ECMWFæ•°æ®...", null);
                
                const params = new URLSearchParams({
                    latitude: loc.lat,
                    longitude: loc.lon,
                    hourly: 'temperature_2m,dewpoint_2m,precipitation,rain,snowfall,weather_code,wind_speed_10m,wind_direction_10m,wind_gusts_10m,cloud_cover,relative_humidity_2m,pressure_msl',
                    wind_speed_unit: 'ms',
                    timezone: 'GMT',
                    forecast_days: 7,
                    timeformat: 'unixtime' 
                });

                const res = await fetch(`https://api.open-meteo.com/v1/ecmwf?${params.toString()}`);
                if (!res.ok) throw new Error(`API Error: ${res.status}`);
                const data = await res.json();

                renderChart(data, code, loc.name);
                setLoader(false);

            } catch (err) {
                console.error(err);
                setLoader(true, null, err.message);
            }
        }

        function renderChart(data, code, name) {
            const dom = document.getElementById('chart');
            if (!myChart) {
                myChart = echarts.init(dom, 'dark');
                window.addEventListener('resize', () => myChart.resize());
                
                myChart.on('dataZoom', function (params) {
                    if(!myChart) return;
                    const opt = myChart.getOption();
                    if(!opt.dataZoom) return;
                    
                    // å®æ—¶æ›´æ–°å½“å‰Zoomå€¼ï¼Œå¦‚æœé”å®šå¼€å¯ï¼Œåˆ™æ›´æ–°ä¿å­˜çš„å€¼
                    // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬å…è®¸ç”¨æˆ·åœ¨é”å®šçŠ¶æ€ä¸‹æ‹–åŠ¨ï¼Œæ‹–åŠ¨åè¯¥ä½ç½®æˆä¸ºæ–°çš„é”å®šä½ç½®
                    const start = opt.dataZoom[0].start;
                    const end = opt.dataZoom[0].end;
                    
                    if (isZoomLocked) {
                        savedZoomStart = start;
                        savedZoomEnd = end;
                    }

                    const range = end - start; 
                    const newInterval = range <= 43 ? 0 : 2; 

                    if (newInterval !== currentZoomInterval) {
                        currentZoomInterval = newInterval;
                        myChart.setOption({
                            xAxis: [
                                { axisLabel: { interval: currentZoomInterval } }, 
                                { axisLabel: { interval: currentZoomInterval } }
                            ]
                        });
                    }
                });
            }

            const h = data.hourly;
            
            // è®¡ç®—èµ·æŠ¥ä¿¡æ¯
            const firstTime = h.time[0];
            const ftDate = new Date(firstTime * 1000);
            const ftStr = `${ftDate.getUTCDate()}æ—¥${String(ftDate.getUTCHours()).padStart(2,'0')}Z`;
            const initStr = `æ¨¡å¼ï¼šECMWF IFS / é¢„æŠ¥èµ·å§‹ï¼š${ftStr}`;

            const times = h.time.map((t, i) => {
                const d = new Date(t * 1000); 
                const hour = d.getUTCHours();
                const hourStr = String(hour).padStart(2,'0') + 'Z';
                
                if (hour === 0 || i === 0) {
                    const mm = String(d.getUTCMonth() + 1).padStart(2,'0');
                    const dd = String(d.getUTCDate()).padStart(2,'0');
                    return `${hourStr}\n${mm}-${dd}`;
                } else {
                    return `${hourStr}\n`;
                }
            });

            const colors = {
                wind: '#38bdf8', gust: '#7dd3fc', temp: '#fbbf24', dew: '#2dd4bf', 
                rain: '#3b82f6', snow: '#c084fc', cloud: '#a78bfa',
                humidity: '#22d3ee', æ°”å‹: '#4ade80'
            };

            // è®¡ç®—NOWçº¿ä½ç½®
            const nowTs = Date.now() / 1000;
            const nowIdx = h.time.findIndex(t => t >= nowTs);
            const nowLine = {
                symbol: ['none', 'none'],
                label: { show: false }, 
                lineStyle: { color: '#fff', type: 'dashed', width: 2, opacity: 0.8 }, 
                data: nowIdx !== -1 ? [{ xAxis: nowIdx }] : [],
                z: 10
            };
            
            // ç¡®å®š DataZoom çš„åˆå§‹å€¼
            // å¦‚æœå·²é”å®šï¼Œä½¿ç”¨ä¿å­˜çš„å€¼ï¼›å¦åˆ™ä½¿ç”¨é»˜è®¤ 0-100
            let initStart = 0;
            let initEnd = 100;
            
            if (isZoomLocked) {
                initStart = savedZoomStart;
                initEnd = savedZoomEnd;
                // è®¡ç®—å½“å‰ range å¯¹åº”çš„ interval
                const range = initEnd - initStart;
                currentZoomInterval = range <= 43 ? 0 : 2;
            } else {
                currentZoomInterval = 2;
            }

            const marker = (color) => `<span style="display:inline-block;margin-right:4px;border-radius:50%;width:10px;height:10px;background-color:${color};"></span>`;

            const option = {
                backgroundColor: '#1e293b', 
                legend: [
                    {
                        show: true, type: 'scroll',
                        top: 35, right: 160,
                        itemWidth: 14, itemHeight: 10, itemGap: 15,
                        backgroundColor: 'rgba(30, 41, 59, 0.7)', 
                        borderColor: '#475569', borderWidth: 1, borderRadius: 15,
                        padding: [8, 15], 
                        textStyle: { color: '#cbd5e1', fontSize: 12 },
                        pageIconColor: '#cbd5e1', pageTextStyle: { color: '#cbd5e1' },
                        data: ['é£é€Ÿ', 'é˜µé£', 'æ°”æ¸©', 'éœ²ç‚¹', 'æ°”å‹'],
                        selected: { 'æ°”å‹': false }
                    },
                    {
                        show: true, type: 'scroll',
                        top: '54%', right: 160, 
                        itemWidth: 14, itemHeight: 10, itemGap: 15,
                        backgroundColor: 'rgba(30, 41, 59, 0.7)', 
                        borderColor: '#475569', borderWidth: 1, borderRadius: 15,
                        padding: [8, 15], 
                        textStyle: { color: '#cbd5e1', fontSize: 12 },
                        pageIconColor: '#cbd5e1', pageTextStyle: { color: '#cbd5e1' },
                        data: ['é™é›¨', 'é™é›ª', 'äº‘é‡', 'ç›¸å¯¹æ¹¿åº¦']
                    }
                ],
                title: {
                    text: `{name|${code}-${name}} {info|${initStr}}`,
                    left: 20, top: 10,
                    textStyle: {
                        rich: {
                            name: { color: '#fff', fontSize: 18, fontWeight: 'bold' },
                            info: { color: '#94a3b8', fontSize: 12, padding: [4, 0, 0, 10] } 
                        }
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross', label: { backgroundColor: '#333' } },
                    backgroundColor: 'rgba(15, 23, 42, 0.95)',
                    borderColor: '#475569',
                    formatter: function(params) {
                        const i = params[0].dataIndex;
                        const wCode = h.weather_code[i];
                        const wDir = h.wind_direction_10m[i];
                        const pressure = h.pressure_msl[i];
                        const dewPoint = h.dewpoint_2m[i]; 
                        const wxInfo = WMO_CODE_MAP[wCode] || { cn: `æœªçŸ¥ (${wCode})`, safe: true };
                        
                        const rawTime = h.time[i];
                        const d = new Date(rawTime * 1000);
                        const tipTime = `${d.getUTCDate()}æ—¥ ${String(d.getUTCHours()).padStart(2,'0')}Z`;
                        
                        let html = `<div style="border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:5px;font-weight:bold">${tipTime}</div>`;
                        
                        html += `<div style="display:flex;justify-content:space-between;color:#fbbf24;font-weight:bold;margin-bottom:5px;"><span>å¤©æ°”ï¼š </span><span>${wxInfo.danger ? 'âš ï¸ ' : ''}${wxInfo.cn}</span></div>`;
                        
                        const map = {};
                        params.forEach(p => map[p.seriesName] = p);

                        html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                            <span>${marker(colors.wind)} é£å‘</span>
                            <span style="font-weight:bold;font-family:monospace">${getWindDirText(wDir)} (${wDir}Â°)</span>
                        </div>`;

                        if(map['é£é€Ÿ']) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.wind)} é£é€Ÿ</span>
                                <span style="font-weight:bold;font-family:monospace">${map['é£é€Ÿ'].value} m/s</span>
                            </div>`;
                        }

                        if(map['é˜µé£']) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.gust)} é˜µé£</span>
                                <span style="font-weight:bold;font-family:monospace">${map['é˜µé£'].value} m/s</span>
                            </div>`;
                        }

                        if(map['æ°”æ¸©']) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.temp)} æ°”æ¸©</span>
                                <span style="font-weight:bold;font-family:monospace">${map['æ°”æ¸©'].value} Â°C</span>
                            </div>`;
                        }
                        
                        html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                            <span>${marker(colors.dew)} éœ²ç‚¹</span>
                            <span style="font-weight:bold;font-family:monospace">${dewPoint} Â°C</span>
                        </div>`;

                        if(map['ç›¸å¯¹æ¹¿åº¦']) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.humidity)} ç›¸å¯¹æ¹¿åº¦</span>
                                <span style="font-weight:bold;font-family:monospace">${map['ç›¸å¯¹æ¹¿åº¦'].value} %</span>
                            </div>`;
                        }

                        if(map['äº‘é‡']) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.cloud)} äº‘é‡</span>
                                <span style="font-weight:bold;font-family:monospace">${map['äº‘é‡'].value} %</span>
                            </div>`;
                        }

                        html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                            <span>${marker(colors.æ°”å‹)} æ°”å‹</span>
                            <span style="font-weight:bold;font-family:monospace">${pressure} hPa</span>
                        </div>`;

                        if(map['é™é›¨'] && map['é™é›¨'].value > 0) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.rain)} é™é›¨</span>
                                <span style="font-weight:bold;font-family:monospace">${map['é™é›¨'].value} mm</span>
                            </div>`;
                        }
                        if(map['é™é›ª'] && map['é™é›ª'].value > 0) {
                            html += `<div style="display:flex;justify-content:space-between;margin-bottom:2px;color:#fff">
                                <span>${marker(colors.snow)} é™é›ª</span>
                                <span style="font-weight:bold;font-family:monospace">${map['é™é›ª'].value} mm</span>
                            </div>`;
                        }

                        return html;
                    }
                },
                axisPointer: {
                    link: { xAxisIndex: 'all' },
                    label: { backgroundColor: '#777' }
                },
                grid: [
                    { top: 70, left: 45, right: 45, height: '38%' },
                    { top: '60%', left: 45, right: 45, height: '30%' } 
                ],
                xAxis: [
                    { 
                        type: 'category', data: times, gridIndex: 0, 
                        axisLine: { show: false }, axisTick: { show: true, alignWithLabel: true }, 
                        axisLabel: { 
                            show: true, 
                            color: '#94a3b8', 
                            fontSize: 10, 
                            interval: currentZoomInterval, 
                            formatter: function(value, index) {
                                const dir = h.wind_direction_10m[index];
                                return getWindDirText(dir);
                            }
                        }, 
                        markLine: null 
                    },
                    { 
                        type: 'category', data: times, gridIndex: 1, 
                        axisLine: { lineStyle: { color: '#475569' } }, 
                        axisLabel: { color: '#94a3b8', fontSize: 11, interval: currentZoomInterval, lineHeight: 14 }
                    }
                ],
                yAxis: [
                    // Grid 0 (ä¸Šå›¾) Yè½´
                    { 
                        type: 'value', name: 'ç±³/ç§’', gridIndex: 0, min: 0, 
                        splitLine: { lineStyle: { type: 'dashed', color: '#334155' } }, 
                        axisLabel: { color: colors.wind }, 
                        nameTextStyle: { color: colors.wind } 
                    },
                    { 
                        type: 'value', name: 'æ‘„æ°åº¦', gridIndex: 0, 
                        position: 'right', 
                        splitLine: { show: false }, 
                        axisLabel: { color: colors.temp }, 
                        nameTextStyle: { color: colors.temp } 
                    },
                    // Grid 1 (ä¸‹å›¾) Yè½´
                    { 
                        type: 'value', name: 'ç™¾åˆ†æ¯”', gridIndex: 1, max:100, 
                        splitLine:{lineStyle:{type:'dashed',color:'#334155'}}, 
                        axisLabel:{color:colors.cloud}, nameTextStyle:{color:colors.cloud} 
                    },
                    { 
                        type: 'value', name: 'æ¯«ç±³', gridIndex: 1, 
                        position: 'right', 
                        splitLine:{show:false}, 
                        axisLabel:{color:colors.rain}, nameTextStyle:{color:colors.rain} 
                    },
                    { type: 'value', min: 950, max: 1050, gridIndex: 0, show: false } 
                ],
                dataZoom: [
                    { 
                        type: 'inside', xAxisIndex: [0, 1], 
                        start: initStart, end: initEnd 
                    },
                    { 
                        type: 'slider', xAxisIndex: [0, 1], 
                        bottom: 5, height: 15, 
                        borderColor:'transparent', fillerColor:'rgba(56,189,248,0.2)',
                        start: initStart, end: initEnd 
                    }
                ],
                series: [
                    {
                        name: 'é£é€Ÿ', type: 'line', xAxisIndex: 0, yAxisIndex: 0,
                        data: h.wind_speed_10m,
                        smooth: true, showSymbol: false,
                        lineStyle: { color: colors.wind, width: 2 },
                        itemStyle: { color: colors.wind },
                        areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1, [{offset:0, color:'rgba(56,189,248,0.3)'}, {offset:1, color:'rgba(56,189,248,0)'}]) },
                        markLine: nowLine
                    },
                    {
                        name: 'é˜µé£', type: 'line', xAxisIndex: 0, yAxisIndex: 0,
                        data: h.wind_gusts_10m,
                        smooth: true, showSymbol: false,
                        lineStyle: { color: colors.gust, width: 1, type: 'dashed' },
                        itemStyle: { color: colors.gust }
                    },
                    {
                        name: 'æ°”å‹', type: 'line', xAxisIndex: 0, yAxisIndex: 4, 
                        data: h.pressure_msl,
                        smooth: true, showSymbol: false,
                        lineStyle: { color: colors.æ°”å‹, width: 1, type: 'dashed' },
                        itemStyle: { color: colors.æ°”å‹ }
                    },
                    {
                        name: 'æ°”æ¸©', type: 'line', xAxisIndex: 0, yAxisIndex: 1,
                        data: h.temperature_2m,
                        smooth: true, showSymbol: false,
                        lineStyle: { color: colors.temp, width: 2 },
                        itemStyle: { color: colors.temp }
                    },
                    {
                        name: 'éœ²ç‚¹', type: 'line', xAxisIndex: 0, yAxisIndex: 1,
                        data: h.dewpoint_2m,
                        smooth: true, showSymbol: false,
                        lineStyle: { color: colors.dew, width: 1.5 },
                        itemStyle: { color: colors.dew }
                    },
                    {
                        name: 'é™é›¨', type: 'bar', stack: 'precip', xAxisIndex: 1, yAxisIndex: 3,
                        data: h.rain, itemStyle: { color: colors.rain }
                    },
                    {
                        name: 'é™é›ª', type: 'bar', stack: 'precip', xAxisIndex: 1, yAxisIndex: 3,
                        data: h.snowfall, itemStyle: { color: colors.snow }
                    },
                    {
                        name: 'äº‘é‡', type: 'line', xAxisIndex: 1, yAxisIndex: 2,
                        data: h.cloud_cover,
                        smooth: true, showSymbol: false,
                        lineStyle: { color: colors.cloud, width: 2, type: 'dashed' },
                        itemStyle: { color: colors.cloud },
                        z: 5,
                        markLine: nowLine
                    },
                    {
                        name: 'ç›¸å¯¹æ¹¿åº¦', type: 'line', xAxisIndex: 1, yAxisIndex: 2, 
                        data: h.relative_humidity_2m,
                        smooth: true, showSymbol: false,
                        lineStyle: { width: 0 }, 
                        itemStyle: { color: colors.humidity },
                        areaStyle: { opacity: 0.2, color: colors.humidity },
                        z: 4
                    }
                ]
            };

            myChart.setOption(option, true);
        }

        window.onload = function() {
            if(typeof echarts === 'undefined') {
                alert("ç»„ä»¶åŠ è½½å¤±è´¥");
            } else {
                query(); 
            }
        };
    </script>
</body>
</html>